# Vite

`Vite`是一个基于`esbuild`的开发工作，其构建基于`rollup`。它最令人亮眼的地方在于其热更新的速度不会随着项目增大都变慢，这一切都归功于`es-module`。

> 除`Vite`外还有一个构建工具也基于同样的道理进行构建应用，它就是[`Snowpack`](https://www.snowpack.dev/)，不同之处在于`Snowpack`将生产模式的构建交给用户来处理。

## 原理简述

### 请求拦截

在浏览器支持`es-module`的当下，每一个模块、或其引入的依赖都会产生一个到后端的`http`请求，并且这个过程是懒的，即仅会请求到目前使用到的模块，不会对整个项目进行请求。

由于**返回的模块**必须要为`es-module`所以，当我们使用类似`CJS/UMD`等类型的模块时，其会被转化为`es-module`(你在书写时就应该准寻规范)后再进行返回。

同理`App.vue`类文件的处理也一样，其会在请求发送到后端时，拦截后转化为`JS`文件如何返回。

#### 对于三方模块引用的处理

在我们引入三方模块时，并不会指定路径，而是直接写入其模块名称。这种情况下，`Vite`会通过依赖项去查找，找到后会在前面补全路径(`node_module/*`)；没有找到的情况其会返回`404`。

> 对于三方模块，其会设置一个长期缓存，会用其内容 hash 值做名称后缀，方便更新

### 快速的热更新

在传统的开发模式下(基于`WebSocket`或`SSE`)，热更新会将变动的模块以及其依赖项中所有模块打包后然后进行替换，及时其依赖项没有改变；而`Vite`仅仅是替换了变更的模块，这样其做到了热更新速度不随项目增长而增长。

> 这里没有过度叙述热更新的原理，想要了解可以自行去看`webpack`的，原理一样

## 后记

本文只是简单总结了下其工作原理，具体后面会细致学习。

---

Reference:

1. [Vite 原理浅析](https://molunerfinn.com/learn-vite/#%E4%BB%80%E4%B9%88%E6%98%AF-Vite)
